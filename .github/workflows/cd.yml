name: STAGING DEPLOYMENT

on:
  push:
    branches: [ "develop" ]

jobs:
  cd:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: build-artifact
    - name: Build Docker Image
      run: |
        docker build -t cicd-lab-project:staging-latest .
    - name: Deploy Container (Simulated)
      run: |
        docker run -d --name staging-app -p 3000:3000 cicd-lab-project:staging-latest
        sleep 5
    - name: Run Smoke Tests
      run: |
        HTTP_STATUS=$(curl -o /dev/null -s -w "%{http_code}" http://localhost:3000/)
        if [ "$HTTP_STATUS" -ne 200 ]; then
          echo "Smoke test failed: HTTP $HTTP_STATUS"
          exit 1
        fi
